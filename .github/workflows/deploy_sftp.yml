on:
  push:
    branches: [main]
name: ğŸš€ Deploy React App to Production
jobs:
  setup:
    name: ğŸ“Œ Setup build process
    runs-on: ubuntu-latest
    steps:
      - name: â© Checkout latest code
        uses: actions/checkout@v2.3.2
      - name: ğŸŒŸ Setup Node.js 14
        uses: actions/setup-node@v2-beta
        with:
          node-version: '14'
      - name: â¬‡ Install dependencies
        run: yarn install

  build:
    name: ğŸ”¨ Build React App
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§¾ Execute build script
        run: yarn build
        env:
          REACT_APP_SPOTIFY_CLIENT_ID: ${{ secrets.SPOTIFY_CLIENT_ID }}

  deploy:
    name: ğŸ—‚ Deploy production build
    runs-on: ubuntu-latest
    steps:
      - name: â¬† Upload build folder to production server
        uses: SamKirkland/FTP-Deploy-Action@2.0.0
        env:
          FTP_SERVER: 45.85.219.34
          FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
          METHOD: sftp
          PORT: 22
          LOCAL_DIR: build
          REMOTE_DIR: /var/www/composer
          ARGS: --delete